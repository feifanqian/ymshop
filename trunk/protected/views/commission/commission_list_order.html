{echo:JS::import('dialog?skin=brief');}
{echo:JS::import('dialogtools');}
{set:$status=array("<span class='icon icon-lock'>时间锁定中</span>","待计入佣金账号","已计入佣金账号","<span class='icon icon-cancel'>已撤销</span>")}
<form action="" method="post">
<div class="tools_bar clearfix">
    <a class="icon-checkbox-checked icon-checkbox-unchecked" href="javascript:;" onclick="tools_select('id[]',this)" title="全选" data="true"> 全选 </a>
   <!-- <a  class="icon-remove-2" href="javascript:;" onclick="tools_submit({action:'{url:/order/order_del}',msg:'删除后无法恢复，你真的删除吗？'})" title="删除"> 删除</a>!-->
    <a class="icon-delicious" href="{url:/commission/commission_list_order}"> 查看全部</a>
<!--    <a class="icon-eye-blocked" href="{url:/order/order_list/status/2}"> 未审核</a>
    <a class="icon-cogs" href="{url:/order/order_list/status/3}"> 执行中</a>-->

    <span class="fr"><a href='javascript:;' id="condition" class="icon-search" style="" > 筛选条件</a><input id="condition_input" type="hidden" name="condition" value="{$condition}"></span>
</div>
<table class="default" >
    <tr>
        <th style="width:50px">选择</th>
        <th style="width:65px">操作</th>
        <th style="width:180px">订单号</th>
        <th style="width:60px">订单金额 </th>
        <th style="width:140px">购买用户</th>
        <th style="width:140px">佣金受益人</th>
        <th style="width:60px">佣金等级</th>
        <th style="width:60px">单笔佣金金额</th>
        <th style="width:90px">订单佣金总和</th>
        <th style="width:140px;">时间</th>
        <th style="width:120px">佣金状态</th>
    </tr>
    {query:name=commission_log as c fields=c.*,o.order_no,o.order_amount,u1.name as buyer,u2.name as promoter join=left join order as o on c.order_id eq o.id left join user as u1 on c.buyer_id eq u1.id left join user as u2 on c.user_id eq u2.id where=$where id=$obj page=1 order= id desc}
        <tr><td style="width:50px"><input type="checkbox" name="id[]" value="{$item['id']}"></td>
            <td style="width:65px" class="btn_min">
                <div class="operat hidden">
                    <a  class="icon-cog action" href="javascript:;"> 处理</a>
                    <div class="menu_select">
                     <ul>
                       <li><a class="icon-eye" href="javascript:;" onclick="view({$item['order_id']})"> 查看订单信息</a></li>
                     </ul>
                   </div>
                </div>
            </td>
            <td style="width:180px"><a href="?condition=and--c.order_id--eq--{$item['order_id']}">{$item['order_no']}</a></td>
            <td style="width:60px">{$item['order_amount']}</td>
            <td style="width:140px"><a href="?condition=and--c.buyer_id--eq--{$item['buyer_id']}">{$item['buyer']}</a></td>
            <td style="width:140px"><a href="?condition=and--c.user_id--eq--{$item['user_id']}">{$item['promoter']}</a></td>
            <td style="width:60px"><a href="?condition=and--c.commission_level--eq--{$item['commission_level']}">{$item['commission_level']}</a></td>
            <td style="width:60px">{$item['commission_get']}</td>
            <td style="width:90px">{$item['commission_amount']}</td>
            <td style="width:140px">{$item['time']}</td>
            <td style="width:120px"><a href="?condition=and--c.status--eq--{$item['status']}">{$status[$item['status']]}</a></td>
        </tr>
    {/query}
</table>
</form>
<div class="page_nav">
{echo:$obj->pageBar()}
</div>
<script type="text/javascript">
function view(id){
        art.dialog.open("{url:/order/order_view/id/}"+id,{id:'view_dialog',title:'查看订单',resize:false,width:900,height:450});
}
$("#condition").on("click",function(){
  $("body").Condition({input:"#condition_input",okVal:'高级搜索',callback:function(data){tools_submit({action:'{url:/commission/commission_list_order}',method:'get'});},data:{'o.order_no':{name:'订单编号'},'o.order_amount':{'name':'订单金额'},'c.status':{name:'佣金状态',values:{0:'时间锁定中',1:'已可用', 2:'已提现', 3:'已撤销'}},'u1.name':{name:'购买者用户名'},'u2.name':{name:'佣金收益者用户名'},'c.commission_get':{'name':'单笔佣金金额'},'c.commission_amount':{'name':'订单佣金总额'},'c.commission_level':{name:'佣金等级',values:{1:'1',2:'2',3:'3'}}}});
})
</script>
