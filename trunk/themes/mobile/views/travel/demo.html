<!doctype html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=640, user-scalable=no">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="https://cdn.bootcss.com/normalize/8.0.0/normalize.min.css">
    <link rel="stylesheet" href="/static/yuanmeng/three-level/css/allway.css">
    <title>向商家付款</title>
</head>
<body>
<style type="text/css">
.wrap{
  width: 90%;
  height: 400px;
  margin-left: 5%;
}
</style>
<script type="text/javascript" src="/themes/mobile/js/jquery.min.js"></script>
<script type="text/javascript" src="/themes/mobile/js/jquery.weui.min.js"></script>
<div class="wrap">
{if:$third_pay==0 and in_array($user_id, [42608,141585,140531])}
    <form action="{url:/payment/yinpay}" method="post" id="payform">
        <input type="hidden" name="order_no" value="{$order_no}">
        {if:$pay_type=='alipay'}
        <input type="hidden" name="payment_id" value="8">
        {else:}
        <input type="hidden" name="payment_id" value="6">
        {/if}
        <input type="hidden" name="seller_id" value="{$seller_id}">
        <input type="hidden" name="seller_ids" value="{$seller_ids}">
        <input type="hidden" name="cashier_id" value="{$cashier_id}">
        <input type="hidden" name="desk_id" value="{$desk_id}">
        <input type="hidden" name="order_amount" id="order_amount" value="">
        <p style="font-size: 16px;"><img src="/themes/mobile/images/shoplogo.png" width="26" height="26">&nbsp;&nbsp;&nbsp;{$shop_name}</p>
        <div class="shuru">
            <span style="color:#f1784c">&yen;</span>
            <div id="div" style="font-size: 32px;color:#f1784d;"></div>
        </div>
        <div class="weui_cells weui_cells_access">
            <div class="weui_cell ">
                <div class="weui_cell_bd weui_cell_primary">
                    <p><b>支付方式</b></p>
                </div>
                <div class="weui_cell_ft">
                    {if:$pay_type=='alipay'}
                    <input class="weui_input" id="paytypes" name='paytype' type="text" value="支付宝支付" data-values="8" style='text-align:right;display:inline-block;width:auto;font-size:16px;' />
                    {else:}
                      {if:$paytypeone}
                        <input class="weui_input" id="paytypes" name='paytype' type="text" value="{$paytypeone['pay_name']}" data-values="{$paytypeone['id']}" style='text-align:right;display:inline-block;width:auto;font-size:16px;' />
                      {/if}
                    {/if}
                </div>
            </div>
        </div>
        <input type="submit" value="确认支付" class="submit" />
    </form>
    {else:}
    <form action="{url:/payment/dopays}" method="post" id="payform">
        <input type="hidden" name="order_no" value="{$order_no}">
        {if:$pay_type=='alipay'}
        <input type="hidden" name="payment_id" value="8">
        {else:}
        <input type="hidden" name="payment_id" value="6">
        {/if}
        <input type="hidden" name="seller_id" value="{$seller_id}">
        <input type="hidden" name="seller_ids" value="{$seller_ids}">
        <input type="hidden" name="cashier_id" value="{$cashier_id}">
        <input type="hidden" name="desk_id" value="{$desk_id}">
        <input type="hidden" name="order_amount" id="order_amount" value="">
        <p style="font-size: 16px;"><img src="/themes/mobile/images/shoplogo.png" width="26" height="26">&nbsp;&nbsp;&nbsp;{$shop_name}</p>
        <div class="shuru">
            <span style="color:#f1784c">&yen;</span>
            <div id="div" style="font-size: 32px;color:#f1784d;"></div>
        </div>
        <div class="weui_cell ">
            <div class="weui_cell_bd weui_cell_primary">
                <p style="font-size:16px;">付款方式</p>
            </div>
            <div class="weui_cell_ft">
                <!-- <input class="weui_input" id="paytype" name='paytype' type="text" readonly="readonly" value="微信支付" data-values="6" style='text-align: right;display:inline-block;width:auto;font-size:16px;' /> -->
                {if:$pay_type=='alipay'}
                <input class="weui_input" id="paytypes" name='paytype' type="text" value="支付宝支付" data-values="8" style='text-align:right;display:inline-block;width:auto;font-size:16px;' />
                {else:}
                  {if:$paytypeone}
                    <input class="weui_input" id="paytypes" name='paytype' type="text" value="{$paytypeone['pay_name']}" data-values="{$paytypeone['id']}" style='text-align:right;display:inline-block;width:auto;font-size:16px;' />
                  {/if}
                {/if}  
            </div>
        </div>
        <input type="submit" value="确认支付" class="submit" />
    </form>
    {/if}
    </div>
    <div class="layer"></div>
    <div class="layer-content">
        <div class="form_edit clearfix">
            <div class="num">1</div>
            <div class="num">2</div>
            <div class="num">3</div>
            <div class="num">4</div>
            <div class="num">5</div>
            <div class="num">6</div>
            <div class="num">7</div>
            <div class="num">8</div>
            <div class="num">9</div>
            <div class="num">.</div>
            <div class="num">0</div>
            <div id="remove">删除</div>
        </div>
    </div>
    {set:$paydict = array();}
    {list:items=$paytypelist}
    {set:$paydict[]=array('title'=>$item['pay_name'], 'value'=>$item['id']);}
    {/list}
    <script type="text/javascript">
    $(function () {
       var color_list = {0:'url(https://ymlypt.b0.upaiyun.com/data/uploads/2018/09/03/cd5157d1ceeb32cc2b0fa56b3570c650.png)',1:'url(https://ymlypt.b0.upaiyun.com/data/uploads/2018/09/03/728315016561eb34185ca91c31d187c6.png)',2:'url(https://ymlypt.b0.upaiyun.com/data/uploads/2018/09/03/d5c38558e8ce321daf8ca0bdc0dcf653.png)'};
       // var index = parseInt(2*Math.random());
       var index = Math.floor(Math.random() * 3);
        $('.wrap').css('background-image',color_list[index]);
        $('.wrap').css('background-size',"cover");
        $('.wrap').css('background-repeat',"no-repeat");
        $('.wrap').css('background-position',"center");
    });  
  </script>
</body>
<script>
    $(function(){
        
        //填写信息
        $('.infor-sub').click(function(e){
            $('.layer').hide();
            $('.form').hide();
            e.preventDefault();     //阻止表单提交
        })
        // 监听#div内容变化，改变支付按钮的颜色
        $('#div').bind('DOMNodeInserted', function(){
            if($("#div").text()!="" || $("#div").text()>'0'){
                $('.submit').removeClass('active');
                $('.submit').attr('disabled', false);
            }else{
                $('.submit').addClass('active');
                $('.submit').attr('disabled', true);
            }
        })
        $('#div').trigger('DOMNodeInserted');
        $('.shuru').click(function(e){
            $('.layer-content').animate({
                bottom: 0
            }, 200)
            e.stopPropagation();
        })
        $('.wrap').click(function(){
            $('.layer-content').animate({
                bottom: '-250px'
            }, 200)
        })
        
        $('.form_edit .num').click(function(){
            var oDiv = document.getElementById("div");
            oDiv.innerHTML += this.innerHTML;
            var amount=$('#div').html();
            $("#order_amount").val(amount);
            // var re=/^(?!0+(?:\.0+)?$)(?:[1-9]\d*|0)(?:\.\d{1,2})?$/;
            // if(!re.test(amount)){
            //     console.log('error');
            //      return false;
            // }
        })
        $('#remove').click(function(){
            var oDiv = document.getElementById("div");
            var oDivHtml = oDiv.innerHTML;
            oDiv.innerHTML = oDivHtml.substring(0,oDivHtml.length-1);
            var amounts=$('#div').html();
            $("#order_amount").val(amounts);
        });
        $("#paytypes").select({
            title: "选择支付方式",
            items: {echo: json_encode($paydict); },
            onChange: function () {
                    var payment_id = $("#paytypes").attr("data-values");
                    var payname = $("#paytypes").val();
                    $("input[name='payment_id']").val($("#paytypes").attr("data-values"));
                }
        }); 
    });
</script>
</html>