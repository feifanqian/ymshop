<!doctype html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=640, user-scalable=no">
    <!-- <meta name="viewport" content="width=device-width,initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no"/> -->
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="https://cdn.bootcss.com/normalize/8.0.0/normalize.min.css">
    <title>运营管理</title>
</head>
<style type="text/css">
body{
    width: 96%;
    background: #f5f5f6;
}
/*#app{
    margin-top: -3%;
    background-color: #f5f5f6;
    padding-top: 20px;
}*/
.header{
    width: 100%;
    height: 100px;
    background: #fff;
    line-height: 100px;
    padding-left: 3%;
}
.header p{
    font-size: 26px;
    color: #363636;
}
.Wdate{
    width: 26%;
    padding-left: 2%;
    height: 50px !important;
    background: #fff url(/themes/mobile/images/op_center/date_bg.png) no-repeat right !important;
    background-size: 100% 50px !important;
    color: #fff;
    text-align: left;
    border: none !important;
    font-size: 90% !important;
}
.block{
    width: 96%;
    margin-left: 4%;
    background-color: #fff;
    height: 360px;
    margin-top: 20px;
    border-radius: 24px;
}
.line{
    margin-top: 10px;
    width: 94%;
    height: 60px;
    margin-left: 4%;
    padding-left: 2%;
    font-size: 26px;
    line-height: 60px;
    color: #333; 
}
.lines{
    margin-top: 26px;
    width: 100%;
    height: 80px;
    padding-left: 3%;
    font-size: 26px;
    line-height: 80px;
    color: #333;
    margin-bottom: 26px;
    background-color: #fff;
}
.line img{
    vertical-align: -6%;
}
.line span{
    color:#ccc;
}
.line-info{
    border-top: 0.02px solid #eee;
    padding-left: 5%;
    padding-top: 10px;
    padding-bottom: 20px;
}
.line-info span{
    display: inline-block;
    width: 32%;
    height: 130px;
    float: left;
    font-size: 24px;
    color: #666;
    border-bottom: 0.02px solid #eee;
    padding-top: 20px;
}
.line-info b{
    display: block;
    font-weight: 500;
    width: 100px;
    text-align: center;
    margin: 0 auto;
}
.line-info p{
    color: #ff6600;
    text-align: center;
}
.line-info img{
    width: 33px;
    height: 33px;
    vertical-align: -33%;
}
.line-infos{
    margin-top: -10px;
    border-top: 0.1px solid #ccc;
    padding-left: 5%;
    padding-top: 10px;
    height: 180px;
}
.line-infos span{
    display: inline-block;
    width: 80%;
    height: 33px;
    float: left;
    font-size: 24px;
    color: #666;
}
.line-infos p{
    display: inline;
}
.line-infos img{
    width: 30px;
    height: 30px;
    vertical-align: -6%;
}
.list-child{
    width: 86%;
    margin-left: 4%;
    height: 180px;
    padding-left: 5%;
    padding-right: 5%;
    padding-bottom: 10px;
    padding-top: 14px;
    margin-bottom: 26px;
    border-radius: 24px;
    background-color: #fff;
}
.div-child{
    width: 100%;
    height: 33px;
    margin-bottom: 4px;
}
.div-child a{
    text-decoration: none;
    color: #4eabf4;
    float: right;
    font-size: 20px;
}
.div-child span{
    color:#666;
    font-size: 20px;
    font-weight: 500;
}
.div-child p{
    width: 100px;
    font-weight: 500;
    font-size: 22px;
    text-align: center;
}
.span-right{
    float: right;
    margin-right: 2%;
}
iframe{
    width: 400px !important;
    height: 370px !important;
}
.WdateDiv{
    width: 400px !important;
    height: 370px !important;
}
.child-left{
    width: 18%;
    margin-top: 20px;
    height: 176px;
    float: left;
}
.child-right{
    width: 80%;
    margin-left: 2%;
    float: left;
    padding-top: 10px;
}
.WdateDiv .yminput, .WdateDiv .yminputfocus{
    font-size: 18px !important;
}
.WdateDiv .WdayTable{
    height: 300px !important;
}
.WdateDiv td{
    height: 30px !important;
    line-height: 30px !important;
    font-size: 18px !important;
}
.WdateDiv #dpControl{
    height: 30px !important;
}
.WdateDiv .dpButton{
    width: 60px !important;
    height: 30px !important;
}
</style>
<body>
<!-- <div id="app"> -->
  <input type="hidden" name="page" id="page" value="{$page}"/>
  <div class="header">
    <p>
     统计时间：
     <input name="start_date" id="start_date" type="text" class="Wdate"   pattern="required"  onChange="" value="{$start_date|date('Y-m-d H:i:s',strtotime($start_date))|''}" onfocus="WdatePicker()">
    &nbsp;&nbsp;至&nbsp;&nbsp;
    <input name="end_date" id="end_date" class="Wdate" type="text" pattern="required" onChange="" value="{$end_date|date('Y-m-d H:i:s',strtotime($end_date))|''}"  onfocus="WdatePicker()">
    </p>
  </div>
  <div class="block">
    <div class="line"><img src="/themes/mobile/images/op_center/line.png">&nbsp;&nbsp;数量统计</div>
    <div class="line-info">
      <span style="border-right: 0.02px solid #eee;"><b>线上总订单</b><p id="order_num">{$result['order_num']}</p></span>
      <span style="border-right: 0.02px solid #eee;"><b>扫码总订单</b><p id="offline_order_num">{$result['offline_order_num']}</p></span>
      <span><b>经销商数量</b><p id="shop_num">{$result['shop_num']}</p></span>
      <span style="border-right: 0.02px solid #eee;border-bottom: none;"><b>商家数量</b><p id="promoter_num">{$result['promoter_num']}</p></span>
      <span style="border-right: 0.02px solid #eee;border-bottom: none;"><b>旗下总会员数</b><p id="user_num">{$result['user_num']}</p></span>
      <span style="border-right: 0.02px solid #eee;border-bottom: none;"><b>优惠购订单数</b><p id="taoke_num">{$result['taoke_num']}</p></span>
    </div>
  </div>
  <div class="block">
    <div class="line"><img src="/themes/mobile/images/op_center/line.png">&nbsp;&nbsp;金额总统计</div>
    <div class="line-info">
      <span style="border-right: 0.02px solid #eee;"><b>线上订单总金额</b><p id="order_sum">{$result['order_sum']}</p></span>
      <span style="border-right: 0.02px solid #eee;"><b>扫码订单总金额</b><p id="offline_order_sum">{$result['offline_order_sum']}</p></span>
      <span><b>线上订单跨界收益</b><p id="order_benefit">{$result['order_benefit']}</p></span>
      <span style="border-right: 0.02px solid #eee;border-bottom: none;"><b>扫码订单跨界收益</b><p id="crossover_sum">{$result['crossover_sum']}</p></span>
      <span style="border-right: 0.02px solid #eee;border-bottom: none;"><b>优惠购收益</b><p id="benefit_sum">{$result['benefit_sum']}</p></span>
    </div>
  </div>
  <div class="lines" style="font-weight: 500;">旗下经销商/商家</div>
  <!-- <div class="block"> -->
   <div class="list" id="list">
     {if:count($list['data'])>0}
        {list:items=$list['data']}
        <div class="list-child">
            <div class="child-left">
                 <div class="div-child">
                     {set:$avatar = $item['avatar']}
                     <img src="{url:@$avatar}" width="90" height="90" style="border-radius: 50%">
                     {if:$item['role_type']==2}
                     <p>经销商</p>
                     {else:}
                     <p>商家</p>
                     {/if}
                 </div>
            </div>
            <div class="child-right">
                <div class="div-child">
                    <span>名称：{$item['real_name'] | $item['nickname']}</span>
                </div>
                <div class="div-child">
                    <span>手机号：{$item['mobile'] | '--'}</span>
                </div>
                <div class="div-child">
                    <span>经营者：{$item['realname'] | $item['mobile'] | $item['real_name']}</span>
                </div>
                <div class="div-child">
                    <span>加入时间：{$item['create_time']}</span>
                    <a href="/operation/shop_info?user_id={$item['id']}">查看详情&nbsp;></a> 
                </div>
            </div>    
        </div>
        {/list}
     {else:}
       <div class="list-child" style="text-align: center;margin-top: 10%;">暂无经销商/商家</div>  
     {/if}
   </div>
  <!-- </div> -->
<!-- </div> -->
</body>
<script src="/runtime/systemjs/jquery.min.js"></script>
<script type="text/javascript" src="/themes/mobile/js/layer_mobile/layer.js"></script>
<script src="/static/js/datepicker.js"></script>
<!-- <script src="/runtime/systemjs/My97DatePicker/calendar.js"></script> -->
<script src="/runtime/systemjs/My97DatePicker/WdatePicker.js"></script>
<script type="text/javascript">
window.onload = function () {
    var start_date = "{$start_date}";
    var end_date = "{$end_date}";
    if(start_date=='') {
        $('#start_date').val('请选择日期');
    }
    if(end_date=='') {
        $('#end_date').val('请选择日期');
    }                    
}
$("input[name='end_date']").blur(function(){
    var page = $('#page').val();
    var start_date = $("input[name='start_date']").val();
    var end_date = $("input[name='end_date']").val();
    var user_id = "{$user_id}";
    var url = "/operation/ajax_operation_order";
    var data = {page: page,user_id:user_id,start_date:start_date,end_date:end_date};
    $.ajax({
            type: 'post',
            dataType: 'json',
            url: url,
            data: data,
            success: function (res) {
                var jsonstr = JSON.stringify(res);
                var jsonarray= $.parseJSON(jsonstr);
                $("#order_num").html(jsonarray.order_num);
                $("#offline_order_num").html(jsonarray.offline_order_num);
                $("#shop_num").html(jsonarray.shop_num);
                $("#promoter_num").html(jsonarray.promoter_num);
                $("#user_num").html(jsonarray.user_num);
                $("#taoke_num").html(jsonarray.taoke_num);
                $("#order_sum").html(jsonarray.order_sum);
                $("#offline_order_sum").html(jsonarray.offline_order_sum);
                $("#order_benefit").html(jsonarray.order_benefit);
                $("#crossover_sum").html(jsonarray.crossover_sum);
                $("#benefit_sum").html(jsonarray.benefit_sum);
            },
        });
    var urls = "{url:/operation/ajax_operation_center}";
    var html = "";
    var avatar = '';
    $.ajax({
            type: 'post',
            dataType: 'json',
            url: urls,
            data: data,
            success: function (res) {
                var jsonstr = JSON.stringify(res);
                var jsonarray= $.parseJSON(jsonstr);
                
                    $.each(jsonarray, function (i, item) {
                        html += '<div class="list-child">';
                        html += '<div class="child-left">';
                        html += '<div class="div-child">';
                        // avatar = item.avatar;
                        html += '<img src="url:@'+item.avatar+'" width="90" height="90" style="border-radius: 50%">';
                        if(item.role_type==2) {
                           html += '<p>经销商</p>';
                        } else {
                           html += '<p>商家</p>';
                        }
                        html += '</div>';
                        html += '</div>';
                        html += '<div class="child-right">';
                        html += '<div class="div-child">';
                        if(item.real_name!=null) {
                           html += '<span>名称：'+item.real_name+'</span>';
                        } else {
                           html += '<span>名称：'+item.nickname+'</span>';
                        }
                        html += '</div>';
                        html += '<div class="div-child">';
                        if(item.mobile!=null) {
                            html += '<span>手机号：'+item.mobile+'</span>';
                        } else {
                            html += '<span>手机号：--</span>';
                        }   
                        html += '</div>';
                        html += '<div class="div-child">';
                        if(item.realname!=null) {
                           html += '<span>经营者：'+item.realname+'</span>';
                        } else if(item.mobile!=null) {
                           html += '<span>经营者：'+item.mobile+'</span>';
                        } else {
                           html += '<span>经营者：'+item.real_name+'</span>';
                        }
                        html += '</div>';
                        html += '<div class="div-child">';
                        html += '<span>加入时间：'+item.create_time+'</span>'
                        html += '<a href="/operation/shop_info?user_id='+item.id+'">查看详情</a>';
                        html += '</div>';
                        html += '</div>';
                        html += '</div>';
                    });
                    $("#list").html(html);
                
            },
        });
});

    var page = $('#page').val();
    $(window).bind('scroll', function () {
    
        var body = $("body");
        var scrollTop = $(this).scrollTop();
        var scrollHeight = body.height();
        var windowHeight = $(this).height();
        
        if (scrollTop + windowHeight >= scrollHeight) {
        // 此处是滚动条到底部时候触发的事件，在这里写要加载的数据，或者是拉动滚动条的操作
           page++;
           ajaxRead();
        }
    });

    function ajaxRead() {
        var html = "";
        var avatar = "";
        var url = "{url:/operation/ajax_operation_center}";
        var user_id = "{$user_id}";
        var start_date = $("input[name='start_date']").val();
        var end_date = $("input[name='end_date']").val();
        var data = {page: page,user_id:user_id,start_date:start_date,end_date:end_date};
        var index;
        $.ajax({
            type: 'post',
            dataType: 'json',
            url: url,
            data: data,
            success: function (res) {
                var jsonstr = JSON.stringify(res);
                var jsonarray= $.parseJSON(jsonstr);
                if (jsonarray.length == 0) {
                    // layer.msg('已经到底!',{time:500});
                }  else {
                    $.each(jsonarray, function (i, item) {
                        html += '<div class="list-child">';
                        html += '<div class="child-left">';
                        html += '<div class="div-child">';
                        // avatar = item.avatar;
                        html += '<img src="'+item.avatar+'" width="90" height="90" style="border-radius: 50%">';
                        if(item.role_type==2) {
                           html += '<p>经销商</p>';
                        } else {
                           html += '<p>商家</p>';
                        }
                        html += '</div>';
                        html += '</div>';
                        html += '<div class="child-right">';
                        html += '<div class="div-child">';
                        if(item.real_name!=null) {
                           html += '<span>名称：'+item.real_name+'</span>';
                        } else {
                           html += '<span>名称：'+item.nickname+'</span>';
                        }
                        html += '</div>';
                        html += '<div class="div-child">';
                        if(item.mobile!=null) {
                            html += '<span>手机号：'+item.mobile+'</span>';
                        } else {
                            html += '<span>手机号：--</span>';
                        }   
                        html += '</div>';
                        html += '<div class="div-child">';
                        if(item.realname!=null) {
                           html += '<span>经营者：'+item.realname+'</span>';
                        } else if(item.mobile!=null) {
                           html += '<span>经营者：'+item.mobile+'</span>';
                        } else {
                           html += '<span>经营者：'+item.real_name+'</span>';
                        }
                        html += '</div>';
                        html += '<div class="div-child">';
                        html += '<span>加入时间：'+item.create_time+'</span>'
                        html += '<a href="/operation/shop_info?user_id='+item.id+'">查看详情</a>';
                        html += '</div>';
                        html += '</div>';
                        html += '</div>';
                    });
                    $("#list").append(html);
                }
            },
        });
    }
</script>
</html>